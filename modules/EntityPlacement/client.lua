local a={["veh"]="SpawnVehicle",["ped"]="SpawnPed",["obj"]="SpawnObject"}local b=nil;local c={moveUp={key=45,name="Move Up"},moveDown={key=49,name="Move Down"},moveForward={key=32,name="Move Forward"},moveBackward={key=33,name="Move Backward"},moveLeft={key=34,name="Move Left"},moveRight={key=35,name="Move Right"},rotateLeft={key=44,name="Rotate Left"},rotateRight={key=46,name="Rotate Right"},finish={key=22,name="Finish"},speed={key=21,name="Speed"},cancel={key=73,name="Cancel"},mode={key=47,name="Move Mode: Entity"}}local d={}for e,f in pairs(c)do d[#d+1]=f.key+1 end;local g=Shared.LookupTable("lib","lookupTables/keyControls.json",d)or{}for e,f in pairs(c)do local h=g[f.key+1]if not h then print(("Failed to find key for %s"):format(f.name))end;f.string=("~%s~"):format(h)end;local i={c.moveUp,c.moveDown,c.moveForward,c.moveBackward,c.moveLeft,c.moveRight,c.rotateLeft,c.rotateRight,c.speed,c.finish,c.cancel,c.mode}Client.EntityPlacement=function(j,k)local l=Client.InstructionalButtonsInitiate(nil,i)if b then Client.DeleteEntity(j,b)end;if k.type=="object"then k.type="obj"end;if k.type=="vehicle"then k.type="veh"end;k.coords=k.coords or Client.GetOffset(j,PlayerPedId(),vector3(0,2,k.type=="ped"and-1 or 0))local m=a[k.type]b=Client[m](j,k)if not DoesEntityExist(b)then return end;SetEntityAlpha(b,150,false)local n=promise.new()local o={coords=GetEntityCoords(b),heading=GetEntityHeading(b)}local p=o.coords;FreezeEntityPosition(b,true)FreezeEntityPosition(PlayerPedId(),true)SetPlayerControl(PlayerId(),false,256)local q=false;local r=0.2;local s=function(r,t,u)return("Speed: %s"):format(r)end;Client.DrawText(j,s(r,o.coords,o.heading))Shared.Loop(j,function()Client.InstructionalButtonsShow(j,l)local v=false;if IsDisabledControlJustReleased(0,c.finish.key)then if q then print(c.finish.name,c.finish.key)end;local w,w,w,w,x=Client.Raycast.FromCoords(j,o.coords,vector3(o.coords.x,o.coords.y,o.coords.z-10))o.groundMaterial=x;Client.DeleteEntity(j,b)if k.type=="ped"then o.coords=vector3(o.coords.x,o.coords.y,o.coords.z-1)end;b=nil;n:resolve(o)end;if IsDisabledControlJustReleased(0,c.mode.key)then if q then print(c.mode.name)end;c.mode.name=c.mode.name=="Move Mode: Entity"and"Move Mode: Grid"or"Move Mode: Entity"i={c.moveUp,c.moveDown,c.moveForward,c.moveBackward,c.moveLeft,c.moveRight,c.rotateLeft,c.rotateRight,c.speed,c.finish,c.cancel,c.mode}l=Client.InstructionalButtonsInitiate(nil,i)end;if IsDisabledControlJustReleased(0,c.cancel.key)then if q then print(c.cancel.name)end;Client.DeleteEntity(j,b)b=nil;n:resolve(false)end;if IsDisabledControlJustReleased(0,c.speed.key)then if q then print(c.speed.name)end;r=r*2;if r>4 then r=0.025 end;v=true end;if IsDisabledControlJustReleased(0,c.moveUp.key)then if q then print(c.moveUp.name)end;o.coords=vector3(o.coords.x,o.coords.y,o.coords.z+r)v=true end;if IsDisabledControlJustReleased(0,c.moveDown.key)then if q then print(c.moveDown.name)end;o.coords=vector3(o.coords.x,o.coords.y,o.coords.z-r)v=true end;if IsDisabledControlJustReleased(0,c.moveForward.key)then if q then print(c.moveForward.name)end;if c.mode.name=="Move Mode: Grid"then o.coords=vector3(o.coords.x,o.coords.y+r,o.coords.z)else local y=Client.GetOffset(j,b,vector3(0,r,0))o.coords=vector3(y.x,y.y,y.z)end;v=true end;if IsDisabledControlJustReleased(0,c.moveBackward.key)then if q then print(c.moveBackward.name)end;if c.mode.name=="Move Mode: Grid"then o.coords=vector3(o.coords.x,o.coords.y-r,o.coords.z)else local y=Client.GetOffset(j,b,vector3(0,-r,0))o.coords=vector3(y.x,y.y,y.z)end;v=true end;if IsDisabledControlJustReleased(0,c.moveLeft.key)then if q then print(c.moveLeft.name)end;if c.mode.name=="Move Mode: Grid"then o.coords=vector3(o.coords.x-r,o.coords.y,o.coords.z)else local y=Client.GetOffset(j,b,vector3(-r,0,0))o.coords=vector3(y.x,y.y,y.z)end;v=true end;if IsDisabledControlJustReleased(0,c.moveRight.key)then if q then print(c.moveRight.name)end;if c.mode.name=="Move Mode: Grid"then o.coords=vector3(o.coords.x+r,o.coords.y,o.coords.z)else local y=Client.GetOffset(j,b,vector3(r,0,0))o.coords=vector3(y.x,y.y,y.z)end;v=true end;if IsDisabledControlJustReleased(0,c.rotateLeft.key)then if q then print(c.rotateLeft.name)end;o.heading=o.heading+r*10;v=true end;if IsDisabledControlJustReleased(0,c.rotateRight.key)then if q then print(c.rotateRight.name)end;o.heading=o.heading-r*10;v=true end;if v then local z=#(o.coords-p)if z<10 then SetEntityCoordsNoOffset(b,o.coords)SetEntityHeading(b,o.heading)Client.DrawText(j,s(r,o.coords,o.heading))else Client.Notify(j,"You cannot move then entity more than 10 units away from the starting position")end end end,{timer=0,thread=true,condition=function()return not b end})local A=Citizen.Await(n)Client.DrawText()SetPlayerControl(PlayerId(),true)FreezeEntityPosition(PlayerPedId(),false)if not A then return end;return{coords=vector4(A.coords.x,A.coords.y,A.coords.z,A.heading),model=k.model,groundMaterial=A.groundMaterial}end