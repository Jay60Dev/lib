Shared.GetLoot=function(a,b,c,d)c=c or 1;local e=0;for f=1,#b do e=e+(b[f].chance or 1)b[f].chanceWeight=e end;local g={}local h={}for f=1,c do::i::local j=math.random(e-1)for k=1,#b do if b[k].chanceWeight>j then if d and h[k]and#h<c then goto i end;g[#g+1]=b[k]if type(g[#g].count)=="table"then local l=g[#g].count.min or 1;local m=g[#g].count.max or 1;g[#g].count=math.random(l,m)end;h[k]=true;break end end end;local n={}for f=1,#g do local o=g[f]for k=1,#n do if Shared.Table.Matches(a,n[k],o)then n[k].count=n[k].count+o.count;goto p end end;n[#n+1]=o::p::end;return n end